<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation &mdash; ImagingLSS 0.9 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ImagingLSS 0.9 documentation" href="index.html" />
    <link rel="next" title="Data Model" href="datamodel.html" />
    <link rel="prev" title="Welcome to ImagingLSS’s documentation!" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="datamodel.html" title="Data Model"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to ImagingLSS’s documentation!"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ImagingLSS 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>ImagingLSS is supposed to be used without installation.</p>
<p>However, some basic packages need to be set up before using the scripts</p>
<div class="section" id="depencency">
<h2>Depencency<a class="headerlink" href="#depencency" title="Permalink to this headline">¶</a></h2>
<p>ImagingLSS is light on dependency.</p>
<p>It depends on mpi4py, for the parallel infrastructure.
It also depends on fitsio or astropy for accessing FITS files.</p>
<div class="highlight-bash"><div class="highlight"><pre>easy_install --user fitsio
<span class="c">#easy_install --user astropy</span>
</pre></div>
</div>
<p>We do recomment pointing the variable PYTHONUSERBASE to a fast filesystem before installing
the dependencies of ImagingLSS. For example, on Edison.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">export </span><span class="nv">PYTHONUSERBASE</span><span class="o">=</span><span class="nv">$SCRATCH</span>

easy_install --user fitsio
<span class="c">#easy_install --user astropy</span>
</pre></div>
</div>
<p>Note that fitsio 0.9.8+ is capable to properly handle the boolean columns in DECALS
catalogue files. Since 0.9.8 has not yet been released, you may need to install this
this version of fitsio which contains this crucial fix:</p>
<p><a class="reference external" href="https://github.com/esheldon/fitsio/tree/150cd">https://github.com/esheldon/fitsio/tree/150cd</a></p>
</div>
<div class="section" id="location-of-data-release">
<h2>Location of Data Release<a class="headerlink" href="#location-of-data-release" title="Permalink to this headline">¶</a></h2>
<p>ImagingLSS tries to initialize the DECALS data release from a configuration file, by
either passing in the file name as an argument to <a class="reference internal" href="imaginglss.html#imaginglss.DECALS" title="imaginglss.DECALS"><code class="xref py py-class docutils literal"><span class="pre">imaginglss.DECALS</span></code></a>
or by setting the environment variable <code class="code docutils literal"><span class="pre">DECALS_PY_CONFIG</span></code>.</p>
<p>Here is an example configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># dr1j.conf.py</span>

<span class="n">decals_root</span> <span class="o">=</span> <span class="s">&quot;/scratch1/scratchdirs/desiproc/dr1j&quot;</span>
<span class="n">decals_cache</span> <span class="o">=</span> <span class="s">&quot;/global/scratch2/sd/yfeng1/desicache/dr1j&quot;</span><span class="p">)</span>
<span class="n">decals_release</span> <span class="o">=</span> <span class="s">&quot;DR1J&quot;</span>
<span class="n">dust_dir</span> <span class="o">=</span> <span class="s">&quot;/project/projectdirs/desi/software/edison/dust/v0_0/&quot;</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">export </span><span class="nv">DECALS_PY_CONFIG</span><span class="o">=</span>/path/to/dr1j.conf.py
</pre></div>
</div>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Before start using imaginglss, it is crucial to build the catalogue cache.</p>
<p>Building the cache takes a long time, and we provide a script <code class="code docutils literal"><span class="pre">scripts/build_cache.py</span></code>.</p>
<p>This is an MPI capable script with good weak scaling and only bound by the file system bandwidth;
We recommend running it with a modest number of cores, 128 or 256.</p>
<p>Python starts slowly on Edison, depending on the condition of the meta data server of the file systems.
We are narrowing down to a permanant solution to this.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># in a job script or an interactive job.</span>
<span class="c"># replace mpirun with aprun on Cray</span>

mpirun -n <span class="m">256</span> python-mpi scripts/build_cache.py
</pre></div>
</div>
<p>For DR1 this takes about 10 mins and produces 300 to 400 GB of data in the
cache directory. Be ready for it.</p>
<p>Now we are ready for some interactive sessions</p>
<div class="highlight-bash"><div class="highlight"><pre>from imaginglss import DECALS
<span class="nv">decals</span> <span class="o">=</span> DECALS<span class="o">()</span> <span class="c"># or DECALS(&#39;/path/to/dr1.conf.py&#39;)</span>

<span class="nv">dr</span> <span class="o">=</span> decals.datarelease
<span class="nv">cat</span> <span class="o">=</span> decals.datarelease.catalogue
<span class="nv">sfd</span> <span class="o">=</span> decals.sfdmap
</pre></div>
</div>
<p>Also refer to the <a class="reference internal" href="examples.html"><em>Examples</em></a> of the documentation.</p>
</div>
<div class="section" id="example-dataset">
<h2>Example Dataset<a class="headerlink" href="#example-dataset" title="Permalink to this headline">¶</a></h2>
<p>We provide a small sampling data set that contains only 1 brick for testing imaginglss.
The small dataset is based on the DR1J data release of DECALS. It can be downloaded at</p>
<p><a class="reference external" href="http://imaginglss.s3-website-us-west-1.amazonaws.com/dr1j-mini.tar.gz">http://imaginglss.s3-website-us-west-1.amazonaws.com/dr1j-mini.tar.gz</a></p>
<p>The total size is less than 30 MB after decompressing.</p>
<p>Note that the SFD98 dust map is also required for most of the ImagingLSS operations.
The SFD98 file is somewhat larger, on the order of 100 MB.</p>
<p><a class="reference external" href="http://imaginglss.s3-website-us-west-1.amazonaws.com/SFD98.tar.gz">http://imaginglss.s3-website-us-west-1.amazonaws.com/SFD98.tar.gz</a></p>
<p>To deploy this dataset with the source code tree,
see the following steps.</p>
<div class="highlight-bash"><div class="highlight"><pre>mkdir testdata
<span class="nb">cd </span>testdata

wget http://imaginglss.s3-website-us-west-1.amazonaws.com/dr1j-mini.tar.gz
tar -xzvf dr1j-mini.tar.gz

wget http://imaginglss.s3-website-us-west-1.amazonaws.com/SFD98.tar.gz
tar -xzvf SFD98.tar.gz

<span class="nb">export </span><span class="nv">DECALS_PY_CONFIG</span><span class="o">=</span><span class="nv">$PWD</span>/dr1j-mini/dr1j-mini.conf.py

<span class="nb">cd</span> -
</pre></div>
</div>
<p>Replace dr1j-mini with edr3 to get the EDR3 dataset.
(
<a class="reference external" href="http://imaginglss.s3-website-us-west-1.amazonaws.com/edr3.tar.gz">http://imaginglss.s3-website-us-west-1.amazonaws.com/edr3.tar.gz</a>
)
EDR3 is older than DR1J, but with more bricks than the mini dataset.</p>
</div>
<div class="section" id="dr1-on-edison">
<h2>DR1 on Edison<a class="headerlink" href="#dr1-on-edison" title="Permalink to this headline">¶</a></h2>
<p>ImagingLSS has been prepackaged for DR1 at Edison in the following locations:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">export </span><span class="nv">DECALS_PY_CONFIG</span><span class="o">=</span>/global/project/projectdirs/m779/imaginglss/dr1/dr1.conf.py
</pre></div>
</div>
<p>Most of code development is happening at that location as well.</p>
<div class="highlight-bash"><div class="highlight"><pre>tree <span class="nv">DECALS_PY_CONFIG</span><span class="o">=</span>/global/project/projectdirs/m779/imaginglss/source
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installation</a><ul>
<li><a class="reference internal" href="#depencency">Depencency</a></li>
<li><a class="reference internal" href="#location-of-data-release">Location of Data Release</a></li>
<li><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li><a class="reference internal" href="#example-dataset">Example Dataset</a></li>
<li><a class="reference internal" href="#dr1-on-edison">DR1 on Edison</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to ImagingLSS&#8217;s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="datamodel.html"
                        title="next chapter">Data Model</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/install.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="datamodel.html" title="Data Model"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to ImagingLSS’s documentation!"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ImagingLSS 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Yu Feng, Martin White.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>