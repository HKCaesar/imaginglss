<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>imaginglss.utils.sharedmem.parallel module &mdash; ImagingLSS 0.9 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ImagingLSS 0.9 documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ImagingLSS 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-imaginglss.utils.sharedmem.parallel">
<span id="imaginglss-utils-sharedmem-parallel-module"></span><h1>imaginglss.utils.sharedmem.parallel module<a class="headerlink" href="#module-imaginglss.utils.sharedmem.parallel" title="Permalink to this headline">¶</a></h1>
<p>OpenMP like multiprocessing</p>
<p>Example:</p>
<blockquote>
<div><dl class="docutils">
<dt>with Parallel(</dt>
<dd><blockquote class="first">
<div>Reduction(numpy.add, a=[0, 0])
) as p:</div></blockquote>
<dl class="last docutils">
<dt>for i, ordered in p.forloop(range(20), </dt>
<dd><blockquote class="first">
<div>ordered=True, schedule=&#8217;dynamic&#8217;):</div></blockquote>
<dl class="last docutils">
<dt>with ordered:</dt>
<dd><p class="first">p.var.a += numpy.array([i, i * 10])
if i == 19:</p>
<blockquote class="last">
<div>raise ValueError(&#8216;raised at i == 19&#8217;)</div></blockquote>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>1 All variables are by default &#8216;Private&#8217;: this differ from OpenMP</p>
<p>2 To access variables defined for the Parallel scope, use p.var</p>
<dl class="docutils">
<dt>3 This is too slow to be useful as I can imagine. </dt>
<dd>Looping in Python is horriblly slow as we know it
and we use iterators to yield values, plus slow posix semaphores.</dd>
<dt>4 forloop returns the iterator for the variable if ordered == False</dt>
<dd>forloop returns the iterator variable and an Ordered object if
ordered==True.</dd>
<dt>5 DeadLocks: </dt>
<dd><p class="first">Tested pretty extensively, but 
there still may be some corner cases.</p>
<p>Biggest bunch I have fixed are because we rely on
an asynchronized Exception(AE) to jump out of a parallel scope
when there are exceptions from slave processes.
In Python AE is unsafe, even with the new &#8216;with&#8217; statement.</p>
<p class="last">As a fix, we limit the AE only between __enter__ and __exit__,
and the only nontrivial object used is Semaphore. In case of
unprotected and failed Semaphore release, we release them one
more time from another thread, guareenteed to be safe from 
the AE we use (signal AE)</p>
</dd>
</dl>
<p>Comparing similiar features between Parallel and OpenMP standard:</p>
<blockquote>
<div><p>Parallel               vs  openmp construct</p>
<dl class="docutils">
<dt>with Parallel() as p:           omp parallel </dt>
<dd><p class="first">xxxx
p.rank                      omp_get_thread_num()
p.num_threads               omp_get_num_threads()</p>
<dl class="docutils">
<dt>p.var.a:                    a referes to the variable &#8216;a&#8217; </dt>
<dd>decleared with Private, Shared or Reduction</dd>
<dt>if p.master:                    omp master </dt>
<dd>xxxx</dd>
<dt>for i in p.forloop():           omp for</dt>
<dd>xxxxj</dd>
</dl>
<p>p.barrier()                       omp barrier</p>
<p>r = p.forloop(ordered=True)     omp for
for i in r:</p>
<blockquote>
<div><dl class="docutils">
<dt>with r.ordered:              omp ordered</dt>
<dd>xxxx</dd>
</dl>
</div></blockquote>
<dl class="last docutils">
<dt>with p.critical:                 omp critical</dt>
<dd>xxxx</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<dl class="class">
<dt id="imaginglss.utils.sharedmem.parallel.Parallel">
<em class="property">class </em><code class="descclassname">imaginglss.utils.sharedmem.parallel.</code><code class="descname">Parallel</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/imaginglss/utils/sharedmem/parallel.html#Parallel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#imaginglss.utils.sharedmem.parallel.Parallel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<dl class="docutils">
<dt><a href="#id1"><span class="problematic" id="id2">**</span></a>kwargs: </dt>
<dd>num_threads: number of processes (default to OMP_NUM_THREADS)</dd>
<dt><a href="#id3"><span class="problematic" id="id4">*</span></a>args:</dt>
<dd>Private(name=value, ....)
Shared(name=value, ....)
Reduction(ufunc, name=value, ....)</dd>
</dl>
<dl class="method">
<dt id="imaginglss.utils.sharedmem.parallel.Parallel.barrier">
<code class="descname">barrier</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/imaginglss/utils/sharedmem/parallel.html#Parallel.barrier"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#imaginglss.utils.sharedmem.parallel.Parallel.barrier" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="imaginglss.utils.sharedmem.parallel.Parallel.forloop">
<code class="descname">forloop</code><span class="sig-paren">(</span><em>range</em>, <em>ordered=False</em>, <em>schedule=('static'</em>, <em>1)</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/imaginglss/utils/sharedmem/parallel.html#Parallel.forloop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#imaginglss.utils.sharedmem.parallel.Parallel.forloop" title="Permalink to this definition">¶</a></dt>
<dd><p>schedule can be
(sch, chunk) or sch;
sch is &#8216;static&#8217;, &#8216;dynamic&#8217; or &#8216;guided&#8217;.</p>
<p>chunk defaults to 1</p>
<p>if ordered, create an ordred</p>
</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="imaginglss.utils.sharedmem.parallel.ParallelException">
<em class="property">exception </em><code class="descclassname">imaginglss.utils.sharedmem.parallel.</code><code class="descname">ParallelException</code><a class="reference internal" href="_modules/imaginglss/utils/sharedmem/parallel.html#ParallelException"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#imaginglss.utils.sharedmem.parallel.ParallelException" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">exceptions.Exception</span></code></p>
<p>When a Slave process is unexpectedly killed (by the OS, eg, OOM)</p>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/imaginglss.utils.sharedmem.parallel.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ImagingLSS 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Yu Feng, Martin White.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>